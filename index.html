<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
	<meta name="mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
	
	<title>Prestige Beauty Studio</title>
	
	<!-- Configuraci√≥n para Firebase y CORS -->
	<meta http-equiv="Cross-Origin-Embedder-Policy" content="credentialless" />
	<meta http-equiv="Cross-Origin-Opener-Policy" content="same-origin" />
	
	<!-- PWA y iconos -->
	<link id="apple-touch-icon" rel="apple-touch-icon" sizes="180x180" href="$GODOT_APPLE_TOUCH_ICON" />
	<link rel="icon" type="image/png" href="$GODOT_ICON" />
	
	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		html, body {
			width: 100%;
			height: 100%;
			overflow: hidden;
			background-color: #0a0a0a;
			font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
		}

		/* Canvas principal de Godot */
		#canvas {
			display: block;
			margin: 0;
			padding: 0;
			border: 0;
			outline: 0;
			width: 100%;
			height: 100%;
			/* Evitar el rebote en iOS */
			-webkit-touch-callout: none;
			-webkit-user-select: none;
			user-select: none;
			/* Mejorar el rendimiento en m√≥viles */
			transform: translateZ(0);
			-webkit-transform: translateZ(0);
		}

		/* Loading screen */
		#loading {
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
			background: linear-gradient(135deg, #1a1a1a 0%, #0a0a0a 100%);
			color: #d4af37;
			font-size: 18px;
			z-index: 1000;
		}

		.loading-logo {
			font-size: 48px;
			font-weight: bold;
			margin-bottom: 20px;
			text-shadow: 0 0 20px rgba(212, 175, 55, 0.5);
		}

		.loading-spinner {
			width: 50px;
			height: 50px;
			border: 4px solid rgba(212, 175, 55, 0.2);
			border-top: 4px solid #d4af37;
			border-radius: 50%;
			animation: spin 1s linear infinite;
			margin-bottom: 20px;
		}

		.loading-text {
			font-size: 16px;
			color: #888;
		}

		@keyframes spin {
			0% { transform: rotate(0deg); }
			100% { transform: rotate(360deg); }
		}

		/* Ocultar cuando cargue */
		#loading.hidden {
			display: none;
		}

		/* Soporte para teclado virtual */
		#canvas:focus {
			outline: none;
		}

		/* Prevenir zoom en inputs en iOS */
		input, textarea, select {
			font-size: 16px !important;
		}
	</style>
</head>
<body>
	<!-- Loading screen -->
	<div id="loading">
		<div class="loading-logo">PRESTIGE</div>
		<div class="loading-spinner"></div>
		<div class="loading-text">Cargando aplicaci√≥n...</div>
	</div>

	<!-- Canvas de Godot -->
	<canvas id="canvas" tabindex="0">
		Tu navegador no soporta HTML5 canvas. Por favor actualiza tu navegador.
	</canvas>

	<script>
		// Configuraci√≥n global
		window.addEventListener('load', function() {
			// Prevenir comportamientos por defecto en m√≥viles
			document.body.addEventListener('touchmove', function(e) {
				// Solo prevenir scroll si no es un input
				if (!e.target.closest('input, textarea')) {
					e.preventDefault();
				}
			}, { passive: false });

			// Prevenir el men√∫ contextual
			document.addEventListener('contextmenu', function(e) {
				if (!e.target.closest('input, textarea')) {
					e.preventDefault();
				}
			});

			// Forzar focus en el canvas
			var canvas = document.getElementById('canvas');
			canvas.addEventListener('touchstart', function() {
				canvas.focus();
			});
		});

		// Detectar cuando Godot est√© listo
		var engine;
		var loadingDiv = document.getElementById('loading');

		// Configuraci√≥n del engine de Godot
		var GODOT_CONFIG = {
			"args": [],
			"canvasResizePolicy": 2,
			"executable": "$GODOT_BASENAME",
			"experimentalVK": true,
			"focusCanvas": true,
			"gdnativeLibs": []
		};

		// Inicializar engine
		(function() {
			var INDETERMINATE_STATUS_STEP_MS = 100;
			var statusProgress = document.getElementById('status-progress');
			var statusProgressInner = document.getElementById('status-progress-inner');
			var statusIndeterminate = document.getElementById('status-indeterminate');
			var statusNotice = document.getElementById('status-notice');

			var initializing = true;
			var statusMode = 'hidden';

			var animationCallbacks = [];
			function animate(time) {
				animationCallbacks.forEach(callback => callback(time));
				requestAnimationFrame(animate);
			}
			requestAnimationFrame(animate);

			function setStatusMode(mode) {
				if (statusMode === mode || !initializing)
					return;
				
				if (mode === 'hidden') {
					// Ocultar loading cuando est√© listo
					loadingDiv.classList.add('hidden');
					initializing = false;
				}
				statusMode = mode;
			}

			function setStatusNotice(text) {
				if (initializing) {
					var loadingText = loadingDiv.querySelector('.loading-text');
					if (loadingText) {
						loadingText.textContent = text;
					}
				}
			}

			function displayFailureNotice(err) {
				console.error(err);
				if (initializing) {
					loadingDiv.innerHTML = `
						<div class="loading-logo">‚ùå</div>
						<div style="color: #ff4444; margin-top: 20px;">Error al cargar la aplicaci√≥n</div>
						<div style="color: #888; margin-top: 10px; max-width: 400px; text-align: center;">${err}</div>
					`;
				}
			}

			// Cargar el engine de Godot
			var script = document.createElement('script');
			script.src = '$GODOT_BASENAME.js';
			script.onload = function() {
				var engine = new Engine(GODOT_CONFIG);

				engine.init('$GODOT_BASENAME.wasm').then(function() {
					return engine.preloadFile('$GODOT_BASENAME.pck');
				}).then(function() {
					engine.startGame({
						'onProgress': function(current, total) {
							if (total > 0) {
								var percent = Math.round((current / total) * 100);
								setStatusNotice('Cargando... ' + percent + '%');
							}
						}
					}).then(function() {
						setStatusMode('hidden');
					}, displayFailureNotice);
				}, displayFailureNotice);
			};
			script.onerror = function() {
				displayFailureNotice('Error al cargar el motor de Godot');
			};
			document.body.appendChild(script);
		})();

		// Soporte para teclado virtual mejorado
		window.addEventListener('resize', function() {
			// Ajustar canvas cuando aparece el teclado
			var canvas = document.getElementById('canvas');
			if (canvas) {
				// Forzar reflow
				canvas.style.height = window.innerHeight + 'px';
			}
		});

		// Prevenir cierre accidental en iOS
		window.addEventListener('beforeunload', function(e) {
			// Solo si hay cambios sin guardar (esto lo manejar√≠a Godot)
			return;
		});

		// Log de informaci√≥n del navegador
		console.log('üåê Prestige Beauty Studio - HTML5');
		console.log('üì± User Agent:', navigator.userAgent);
		console.log('üñ•Ô∏è Screen:', window.screen.width + 'x' + window.screen.height);
		console.log('üîß Touch Support:', 'ontouchstart' in window);
	</script>
</body>
</html>


